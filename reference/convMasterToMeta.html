<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Convert Master File to FlyDreamR Metadata Format — convMasterToMeta • FlyDreamR</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert Master File to FlyDreamR Metadata Format — convMasterToMeta"><meta name="description" content="Converts a DAM (Drosophila Activity Monitor) master file into the metadata
format required by FlyDreamR. The function reads the master file, validates
the start and end times against the corresponding monitor file's light sensor
data, and generates a properly formatted metadata CSV file.
The validation process checks that:
The provided start time matches the first &quot;lights-ON&quot; event on the
specified start date
The provided end time matches the &quot;lights-OFF&quot; event closest to the
specified end time on that date

"><meta property="og:description" content="Converts a DAM (Drosophila Activity Monitor) master file into the metadata
format required by FlyDreamR. The function reads the master file, validates
the start and end times against the corresponding monitor file's light sensor
data, and generates a properly formatted metadata CSV file.
The validation process checks that:
The provided start time matches the first &quot;lights-ON&quot; event on the
specified start date
The provided end time matches the &quot;lights-OFF&quot; event closest to the
specified end time on that date

"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FlyDreamR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/introduction.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Analyzing Sleep States with FlyDreamR</a></li>
    <li><a class="dropdown-item" href="../articles/data-prep.html">Getting data into FlyDreamR</a></li>
    <li><a class="dropdown-item" href="../articles/traditional-sleep.html">Traditional sleep analyses</a></li>
    <li><a class="dropdown-item" href="../articles/hmm-workflow.html">HMM fitting and visualization</a></li>
    <li><a class="dropdown-item" href="../articles/shiny-app.html">Running the FlyDreamR Shiny app</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/orijitghosh/FlyDreamR" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Convert Master File to FlyDreamR Metadata Format</h1>
      <small class="dont-index">Source: <a href="https://github.com/orijitghosh/FlyDreamR/blob/HEAD/R/convMasterToMeta.R" class="external-link"><code>R/convMasterToMeta.R</code></a></small>
      <div class="d-none name"><code>convMasterToMeta.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Converts a DAM (Drosophila Activity Monitor) master file into the metadata
format required by FlyDreamR. The function reads the master file, validates
the start and end times against the corresponding monitor file's light sensor
data, and generates a properly formatted metadata CSV file.</p>
<p>The validation process checks that:</p><ul><li><p>The provided start time matches the first "lights-ON" event on the
specified start date</p></li>
<li><p>The provided end time matches the "lights-OFF" event closest to the
specified end time on that date</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">convMasterToMeta</span><span class="op">(</span></span>
<span>  <span class="va">metafile</span>,</span>
<span>  startDT <span class="op">=</span> <span class="st">"2024-04-11 06:00:00"</span>,</span>
<span>  endDT <span class="op">=</span> <span class="st">"2024-04-16 06:00:00"</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"."</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-metafile">metafile<a class="anchor" aria-label="anchor" href="#arg-metafile"></a></dt>
<dd><p>Character string. Full path to the input master file.
No default value - must be specified.</p>
<p><strong>Example</strong>: <code>"path/to/master53.txt"</code></p></dd>


<dt id="arg-startdt">startDT<a class="anchor" aria-label="anchor" href="#arg-startdt"></a></dt>
<dd><p>Character string. Expected experimental start date and time
in format <code>"YYYY-MM-DD HH:MM:SS"</code>.</p>
<p>Default: <code>"2024-04-11 06:00:00"</code>.</p>
<p>This should correspond to a lights-ON event in the monitor file. The function
will validate this by checking the monitor file's light sensor data and warn
if there's a mismatch.</p></dd>


<dt id="arg-enddt">endDT<a class="anchor" aria-label="anchor" href="#arg-enddt"></a></dt>
<dd><p>Character string. Expected experimental end date and time
in format <code>"YYYY-MM-DD HH:MM:SS"</code>.</p>
<p>Default: <code>"2024-04-16 06:00:00"</code>.</p>
<p>This should correspond to a lights-OFF event in the monitor file. The function
will find the lights-OFF event on the specified date closest to this time.</p></dd>


<dt id="arg-output-dir">output_dir<a class="anchor" aria-label="anchor" href="#arg-output-dir"></a></dt>
<dd><p>Character string. Directory path for saving the output
metadata CSV file.</p>
<p>Default: <code>"."</code> (current working directory).</p>
<p>The directory will be created automatically if it doesn't exist.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Invisibly returns a <code>data.frame</code> containing the formatted metadata
(identical to the CSV file content). The function also writes a CSV file to
disk.</p>
<p><strong>Output filename format</strong>: <code>Metadata_Block[X]Rep[Y]Monitor[Z].csv</code></p>
<p>For example: <code>Metadata_Block1Rep1Monitor53.csv</code></p>
<p><strong>The output CSV contains 6 columns</strong>:</p><dl><dt><code>file</code></dt>
<dd><p>Monitor filename (e.g., "Monitor53.txt"). This should
exist in the same directory as the master file.</p></dd>

<dt><code>start_datetime</code></dt>
<dd><p>Experiment start date and time (from <code>startDT</code>)</p></dd>

<dt><code>stop_datetime</code></dt>
<dd><p>Experiment end date and time (from <code>endDT</code>)</p></dd>

<dt><code>region_id</code></dt>
<dd><p>Channel number within the monitor (1-32)</p></dd>

<dt><code>genotype</code></dt>
<dd><p>Combined identifier in format "Line_Sex"
(e.g., "w1118_F", "mutant_M")</p></dd>

<dt><code>replicate</code></dt>
<dd><p>Combined identifier in format "BlockXRepY"
(e.g., "Block1Rep1", "Block2Rep3")</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="validation-process">Validation Process<a class="anchor" aria-label="anchor" href="#validation-process"></a></h3>


<p>The function performs several validation steps:</p><ol><li><p><strong>Read master file</strong>: Loads and validates structure (8 columns, tab-delimited)</p></li>
<li><p><strong>Filter rows</strong>: Keeps only rows with <code>SetupCode = 1</code></p></li>
<li><p><strong>Locate monitor file</strong>: Assumes monitor file (e.g., "Monitor53.txt")
is in the same directory as the master file</p></li>
<li><p><strong>Parse light sensor data</strong>: Reads the monitor file's 10th column
(light sensor status)</p></li>
<li><p><strong>Find lights-ON event</strong>: Identifies the first 0→1 transition on the
start date</p></li>
<li><p><strong>Find lights-OFF event</strong>: Identifies the lights-OFF event (row before
change==1) on the end date closest to the specified time</p></li>
<li><p><strong>Compare times</strong>: Issues color-coded warnings if provided times don't
match actual transitions</p></li>
<li><p><strong>Generate metadata</strong>: Creates properly formatted output regardless of
validation results</p></li>
<li><p><strong>Save CSV</strong>: Writes to disk with automatic filename generation</p></li>
</ol></div>

<div class="section">
<h3 id="light-sensor-validation">Light Sensor Validation<a class="anchor" aria-label="anchor" href="#light-sensor-validation"></a></h3>


<p>The validation uses the monitor file's light sensor column (column 10):</p><ul><li><p><strong>Value 0</strong>: Lights OFF (dark)</p></li>
<li><p><strong>Value 1</strong>: Lights ON (light)</p></li>
<li><p><strong>Transition 0→1</strong>: Lights turning ON (dawn)</p></li>
<li><p><strong>Row before transition 1→0</strong>: Lights turning OFF (dusk)</p></li>
</ul><p>This validation helps catch common errors like:</p><ul><li><p>Wrong start date (off by one day)</p></li>
<li><p>Incorrect time (using 18:00 instead of 06:00)</p></li>
<li><p>Daylight saving time issues</p></li>
<li><p>Monitor clock drift</p></li>
</ul></div>

<div class="section">
<h3 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h3>


<p>The function will:</p><ul><li><p><strong>Stop with error</strong> if:
- Master file doesn't exist or can't be read
- Master file doesn't have exactly 8 columns
- No rows with SetupCode = 1 found</p></li>
<li><p><strong>Issue warning</strong> if:
- Monitor file not found (validation skipped, metadata still generated)
- Start/end times don't match monitor file transitions
- Multiple unique monitor files implied by master data</p></li>
<li><p><strong>Continue processing</strong> even if validation fails</p></li>
</ul></div>

<div class="section">
<h3 id="file-location-assumptions">File Location Assumptions<a class="anchor" aria-label="anchor" href="#file-location-assumptions"></a></h3>


<p>The function assumes:</p><ul><li><p>Monitor files (e.g., "Monitor53.txt") are in the <strong>same directory</strong>
as the master file</p></li>
<li><p>Monitor filename matches the pattern "MonitorN.txt" where N is the
monitor number from the master file</p></li>
</ul><p>If your files are organized differently, you may need to adjust file paths.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p><strong>Common Issues:</strong></p><ol><li><p><strong>"Start date-time does not match" warning</strong>:</p><ul><li><p>Check that your startDT corresponds to lights turning ON</p></li>
<li><p>Verify the date is correct (not off by one day)</p></li>
<li><p>Confirm time zone matches your incubator settings</p></li>
</ul></li>
<li><p><strong>"Monitor file not found" warning</strong>:</p><ul><li><p>Ensure MonitorN.txt is in the same directory as master file</p></li>
<li><p>Check the monitor number in your master file is correct</p></li>
</ul></li>
<li><p><strong>"No rows with SetupCode = 1"</strong>:</p><ul><li><p>Verify your master file has some rows with SetupCode = 1</p></li>
<li><p>Check for tab-delimited format (not spaces)</p></li>
</ul></li>
</ol></div>
    <div class="section level2">
    <h2 id="master-file-format">Master File Format<a class="anchor" aria-label="anchor" href="#master-file-format"></a></h2>


<p>The master file must be a <strong>tab-delimited text file without a header row</strong>.
It must contain exactly 8 columns in the following order:</p><ol><li><p><strong>Monitor</strong>: Monitor number (integer)</p></li>
<li><p><strong>Channel</strong>: Channel number within the monitor (integer, 1-32 typically)</p></li>
<li><p><strong>Line</strong>: Genotype or line identifier (character)</p></li>
<li><p><strong>Sex</strong>: Sex of the individual (character, e.g., "M" or "F")</p></li>
<li><p><strong>Treatment</strong>: Experimental treatment (character)</p></li>
<li><p><strong>Rep</strong>: Replicate number (integer)</p></li>
<li><p><strong>Block</strong>: Block number for experimental design (integer)</p></li>
<li><p><strong>SetupCode</strong>: Inclusion flag (integer; use <code>1</code> to include
the channel in output, any other value to exclude)</p></li>
</ol><p>Only rows with <code>SetupCode = 1</code> will be included in the output metadata.</p>
    </div>
    <div class="section level2">
    <h2 id="example-master-file">Example Master File<a class="anchor" aria-label="anchor" href="#example-master-file"></a></h2>


<div class="sourceCode"><pre><code>
53  1   w1118   F   control   1   1   1
53  2   w1118   F   control   1   1   1
53  3   mutant  M   drug      1   1   1
53  4   mutant  M   drug      1   1   0
</code></pre></div><p>The 4th row would be excluded (SetupCode = 0).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="convMasterToMetaBatch.html">convMasterToMetaBatch</a></code> for processing multiple master files at once
<code><a href="HMMDataPrep.html">HMMDataPrep</a></code> for using the generated metadata to load DAM data</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic usage with default start/end times</span></span></span>
<span class="r-in"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">convMasterToMeta</span><span class="op">(</span></span></span>
<span class="r-in"><span>  metafile <span class="op">=</span> <span class="st">"path/to/master53.txt"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Output: Metadata_Block1Rep1Monitor53.csv (in current directory)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specify custom start/end times and output directory</span></span></span>
<span class="r-in"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">convMasterToMeta</span><span class="op">(</span></span></span>
<span class="r-in"><span>  metafile <span class="op">=</span> <span class="st">"experiment_data/master53.txt"</span>,</span></span>
<span class="r-in"><span>  startDT <span class="op">=</span> <span class="st">"2024-01-15 09:00:00"</span>,  <span class="co"># Lights ON at 9 AM</span></span></span>
<span class="r-in"><span>  endDT <span class="op">=</span> <span class="st">"2024-01-20 09:00:00"</span>,    <span class="co"># Lights OFF at 9 AM (5 days later)</span></span></span>
<span class="r-in"><span>  output_dir <span class="op">=</span> <span class="st">"processed_metadata"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Output: processed_metadata/Metadata_Block1Rep1Monitor53.csv</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Process master file with validation</span></span></span>
<span class="r-in"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">convMasterToMeta</span><span class="op">(</span></span></span>
<span class="r-in"><span>  metafile <span class="op">=</span> <span class="st">"raw_data/master54.txt"</span>,</span></span>
<span class="r-in"><span>  startDT <span class="op">=</span> <span class="st">"2024-02-01 06:00:00"</span>,</span></span>
<span class="r-in"><span>  endDT <span class="op">=</span> <span class="st">"2024-02-06 18:00:00"</span>     <span class="co"># Ends at dusk instead of dawn</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Function will validate times against Monitor54.txt</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect the returned metadata</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check what files were referenced</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># See genotype combinations</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">genotype</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Arijit Ghosh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

