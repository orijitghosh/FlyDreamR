<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Infer Sleep States Using Hidden Markov Model — HMMbehavr • FlyDreamR</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Infer Sleep States Using Hidden Markov Model — HMMbehavr"><meta name="description" content="Applies a Hidden Markov Model (HMM) to behavioral activity data to infer
discrete sleep/wake states. The model identifies four behavioral states
(State0-State3) ordered by activity level, where State0 represents the
highest activity (active wake) and State3 represents the lowest activity
(deep sleep).
The function fits an HMM with 4 states using Gaussian emission distributions
for normalized activity levels. Multiple iterations are performed for each
individual and day to ensure robust state inference, with the most frequently
inferred state at each time point selected as the final classification."><meta property="og:description" content="Applies a Hidden Markov Model (HMM) to behavioral activity data to infer
discrete sleep/wake states. The model identifies four behavioral states
(State0-State3) ordered by activity level, where State0 represents the
highest activity (active wake) and State3 represents the lowest activity
(deep sleep).
The function fits an HMM with 4 states using Gaussian emission distributions
for normalized activity levels. Multiple iterations are performed for each
individual and day to ensure robust state inference, with the most frequently
inferred state at each time point selected as the final classification."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FlyDreamR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/introduction.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Analyzing Sleep States with FlyDreamR</a></li>
    <li><a class="dropdown-item" href="../articles/data-prep.html">Getting data into FlyDreamR</a></li>
    <li><a class="dropdown-item" href="../articles/traditional-sleep.html">Traditional sleep analyses</a></li>
    <li><a class="dropdown-item" href="../articles/hmm-workflow.html">HMM fitting and visualization</a></li>
    <li><a class="dropdown-item" href="../articles/shiny-app.html">Running the FlyDreamR Shiny app</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/orijitghosh/FlyDreamR" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Infer Sleep States Using Hidden Markov Model</h1>
      <small class="dont-index">Source: <a href="https://github.com/orijitghosh/FlyDreamR/blob/HEAD/R/HMMbehavr.R" class="external-link"><code>R/HMMbehavr.R</code></a></small>
      <div class="d-none name"><code>HMMbehavr.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Applies a Hidden Markov Model (HMM) to behavioral activity data to infer
discrete sleep/wake states. The model identifies four behavioral states
(State0-State3) ordered by activity level, where State0 represents the
highest activity (active wake) and State3 represents the lowest activity
(deep sleep).</p>
<p>The function fits an HMM with 4 states using Gaussian emission distributions
for normalized activity levels. Multiple iterations are performed for each
individual and day to ensure robust state inference, with the most frequently
inferred state at each time point selected as the final classification.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">HMMbehavr</span><span class="op">(</span><span class="va">behavtbl</span>, it <span class="op">=</span> <span class="fl">100</span>, ldcyc <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-behavtbl">behavtbl<a class="anchor" aria-label="anchor" href="#arg-behavtbl"></a></dt>
<dd><p>A <code>behavr</code> table (data.frame/data.table) containing
behavioral data. Must include columns: <code>id</code>, <code>day</code>, <code>normact</code>
(normalized activity), <code>genotype</code>, and <code>t</code> (time in seconds).
Additional metadata columns (e.g., <code>sex</code>, <code>treatment</code>) will be
automatically included in output summaries.
Typically the output from <code><a href="HMMDataPrep.html">HMMDataPrep</a></code>.</p></dd>


<dt id="arg-it">it<a class="anchor" aria-label="anchor" href="#arg-it"></a></dt>
<dd><p>Integer specifying the number of HMM fitting iterations per
individual per day. Must be &gt;= 100 (enforced). Higher values increase
robustness but require more computation time. Default: 100.</p>
<p>Each iteration fits an HMM with random initialization. The final state
assignment at each time point is determined by majority vote across
all iterations, providing a measure of classification confidence.</p></dd>


<dt id="arg-ldcyc">ldcyc<a class="anchor" aria-label="anchor" href="#arg-ldcyc"></a></dt>
<dd><p>Numeric value specifying the light phase duration in hours
(e.g., 12 for LD 12:12). If <code>NULL</code> (default), assumes a 12-hour
light phase. Used to assign "light" and "dark" phase labels to time points.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing two data frames:</p><dl><dt><code>TimeSpentInEachState</code></dt>
<dd><p>Summary of time (in minutes) spent in
each state, grouped by:</p><ul><li><p><code>ID</code>: Individual identifier</p></li>
<li><p><code>Genotype</code>: Genotype</p></li>
<li><p><code>day</code>: Day number</p></li>
<li><p><code>phase</code>: Light or dark phase</p></li>
<li><p><code>state_name</code>: State0, State1, State2, or State3</p></li>
<li><p><code>time_spent</code>: Minutes in that state</p></li>
<li><p>Additional metadata columns (e.g., <code>sex</code>, <code>treatment</code>)</p></li>
</ul><p>All state-phase combinations are present (filled with 0 if not observed).</p></dd>

<dt><code>VITERBIDecodedProfile</code></dt>
<dd><p>Time-series of inferred states with columns:</p><ul><li><p><code>timestamp</code>: Time point index (1 to total time points)</p></li>
<li><p><code>state</code>: Raw HMM state label</p></li>
<li><p><code>state_name</code>: Activity-ordered state name (State0-State3)</p></li>
<li><p><code>phase</code>: Light or dark</p></li>
<li><p><code>ID</code>, <code>Genotype</code>, <code>day</code>: Grouping variables</p></li>
<li><p>Additional metadata columns (e.g., <code>sex</code>, <code>treatment</code>)</p></li>
</ul></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="state-interpretation">State Interpretation<a class="anchor" aria-label="anchor" href="#state-interpretation"></a></h3>


<p>States are ordered by median activity level:</p><ul><li><p><strong>State0</strong>: Highest activity (active wake)</p></li>
<li><p><strong>State1</strong>: Moderate activity (quiet wake)</p></li>
<li><p><strong>State2</strong>: Low activity (light sleep)</p></li>
<li><p><strong>State3</strong>: Lowest activity (deep sleep)</p></li>
</ul></div>

<div class="section">
<h3 id="failed-cases">Failed Cases<a class="anchor" aria-label="anchor" href="#failed-cases"></a></h3>


<p>The function tracks cases where HMM fitting fails or produces invalid results:</p><ul><li><p>No valid solution after maximum iterations</p></li>
<li><p>Single-state dominance (&gt;99% of time in one state) - indicates
insufficient behavioral variability</p></li>
</ul><p>Failed cases are printed to console and excluded from results.</p>
</div>

<div class="section">
<h3 id="performance-notes">Performance Notes<a class="anchor" aria-label="anchor" href="#performance-notes"></a></h3>

<ul><li><p>Progress bar shows overall fitting progress</p></li>
<li><p>For large datasets, consider using <code><a href="HMMbehavrFast.html">HMMbehavrFast</a></code> for
parallel processing</p></li>
<li><p>Typical runtime: ~1-2 seconds per individual-day with it=100</p></li>
</ul></div>

    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Ghosh, A., &amp; Harbison, S. T. (2024). Hidden Markov models reveal
heterogeneity in sleep states. (Add actual reference when published)</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="HMMbehavrFast.html">HMMbehavrFast</a></code> for parallel implementation
<code><a href="HMMDataPrep.html">HMMDataPrep</a></code> for preparing input data
<code><a href="HMMplot.html">HMMplot</a></code> for visualizing results
<code><a href="HMMFacetedPlot.html">HMMFacetedPlot</a></code> for multi-individual visualization</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic usage with default parameters</span></span></span>
<span class="r-in"><span><span class="va">hmm_results</span> <span class="op">&lt;-</span> <span class="fu">HMMbehavr</span><span class="op">(</span>behavtbl <span class="op">=</span> <span class="va">processed_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom light cycle and more iterations</span></span></span>
<span class="r-in"><span><span class="va">hmm_results</span> <span class="op">&lt;-</span> <span class="fu">HMMbehavr</span><span class="op">(</span></span></span>
<span class="r-in"><span>  behavtbl <span class="op">=</span> <span class="va">processed_data</span>,</span></span>
<span class="r-in"><span>  it <span class="op">=</span> <span class="fl">200</span>,           <span class="co"># More robust inference</span></span></span>
<span class="r-in"><span>  ldcyc <span class="op">=</span> <span class="fl">16</span>          <span class="co"># LD 16:8 cycle</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access results with additional metadata</span></span></span>
<span class="r-in"><span><span class="va">time_in_states</span> <span class="op">&lt;-</span> <span class="va">hmm_results</span><span class="op">$</span><span class="va">TimeSpentInEachState</span></span></span>
<span class="r-in"><span><span class="va">state_profile</span> <span class="op">&lt;-</span> <span class="va">hmm_results</span><span class="op">$</span><span class="va">VITERBIDecodedProfile</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Summarize sleep by sex and genotype</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sleep_summary</span> <span class="op">&lt;-</span> <span class="va">time_in_states</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"State2"</span>, <span class="st">"State3"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Genotype</span>, <span class="va">sex</span>, <span class="va">day</span>, <span class="va">phase</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_sleep_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">time_spent</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Arijit Ghosh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

