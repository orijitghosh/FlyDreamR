<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Parallel Hidden Markov Model for Sleep State Inference — HMMbehavrFast • FlyDreamR</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parallel Hidden Markov Model for Sleep State Inference — HMMbehavrFast"><meta name="description" content="Parallelized wrapper for HMMbehavr that processes multiple
individuals simultaneously using multiple CPU cores. This function provides
significant speed improvements for large datasets while maintaining identical
output to the serial version.
Each individual's data is processed independently in parallel, making this
approach ideal for experiments with many animals. The function automatically
handles cluster setup and cleanup."><meta property="og:description" content="Parallelized wrapper for HMMbehavr that processes multiple
individuals simultaneously using multiple CPU cores. This function provides
significant speed improvements for large datasets while maintaining identical
output to the serial version.
Each individual's data is processed independently in parallel, making this
approach ideal for experiments with many animals. The function automatically
handles cluster setup and cleanup."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FlyDreamR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/introduction.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Analyzing Sleep States with FlyDreamR</a></li>
    <li><a class="dropdown-item" href="../articles/data-prep.html">Getting data into FlyDreamR</a></li>
    <li><a class="dropdown-item" href="../articles/traditional-sleep.html">Traditional sleep analyses</a></li>
    <li><a class="dropdown-item" href="../articles/hmm-workflow.html">HMM fitting and visualization</a></li>
    <li><a class="dropdown-item" href="../articles/shiny-app.html">Running the FlyDreamR Shiny app</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/orijitghosh/FlyDreamR" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Parallel Hidden Markov Model for Sleep State Inference</h1>
      <small class="dont-index">Source: <a href="https://github.com/orijitghosh/FlyDreamR/blob/HEAD/R/HMMbehavrFast.R" class="external-link"><code>R/HMMbehavrFast.R</code></a></small>
      <div class="d-none name"><code>HMMbehavrFast.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Parallelized wrapper for <code><a href="HMMbehavr.html">HMMbehavr</a></code> that processes multiple
individuals simultaneously using multiple CPU cores. This function provides
significant speed improvements for large datasets while maintaining identical
output to the serial version.</p>
<p>Each individual's data is processed independently in parallel, making this
approach ideal for experiments with many animals. The function automatically
handles cluster setup and cleanup.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">HMMbehavrFast</span><span class="op">(</span><span class="va">behavtbl</span>, it <span class="op">=</span> <span class="fl">100</span>, n_cores <span class="op">=</span> <span class="fl">4</span>, ldcyc <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-behavtbl">behavtbl<a class="anchor" aria-label="anchor" href="#arg-behavtbl"></a></dt>
<dd><p>A <code>behavr</code> table containing behavioral data for multiple
individuals. See <code><a href="HMMbehavr.html">HMMbehavr</a></code> for required columns.</p></dd>


<dt id="arg-it">it<a class="anchor" aria-label="anchor" href="#arg-it"></a></dt>
<dd><p>Integer (&gt;= 100) specifying the number of HMM fitting iterations
per individual per day. Default: 100. See <code><a href="HMMbehavr.html">HMMbehavr</a></code> for details.</p></dd>


<dt id="arg-n-cores">n_cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>Integer specifying the number of CPU cores to use for parallel
processing. Default: 4.</p>
<p><strong>Recommendations:</strong></p><ul><li><p>Leave 1-2 cores free for system operations</p></li>
<li><p>On HPC: request cores matching this parameter</p></li>
<li><p>Typical desktop: use 2-4 cores</p></li>
<li><p>Check available cores: <code><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">parallel::detectCores()</a></code></p></li>
</ul></dd>


<dt id="arg-ldcyc">ldcyc<a class="anchor" aria-label="anchor" href="#arg-ldcyc"></a></dt>
<dd><p>Numeric specifying light phase duration in hours. If <code>NULL</code>
(default), assumes 12-hour light phase. See <code><a href="HMMbehavr.html">HMMbehavr</a></code> for details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing two data frames with combined results from all
individuals:</p><dl><dt><code>TimeSpentInEachState</code></dt>
<dd><p>Time spent in each state for all individuals</p></dd>

<dt><code>VITERBIDecodedProfile</code></dt>
<dd><p>HMM-inferred state profiles for all individuals</p></dd>


</dl><p>See <code><a href="HMMbehavr.html">HMMbehavr</a></code> for detailed description of output structure.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="parallelization-strategy">Parallelization Strategy<a class="anchor" aria-label="anchor" href="#parallelization-strategy"></a></h3>


<p>The function:</p><ol><li><p>Splits data by individual ID</p></li>
<li><p>Creates a parallel cluster with <code>n_cores</code> workers</p></li>
<li><p>Distributes individuals across workers</p></li>
<li><p>Each worker runs <code><a href="HMMbehavr.html">HMMbehavr</a></code> independently</p></li>
<li><p>Combines results after all workers complete</p></li>
<li><p>Automatically cleans up cluster</p></li>
</ol></div>

<div class="section">
<h3 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a></h3>

<ul><li><p><strong>Speedup</strong>: Near-linear with number of cores (e.g., 4x faster with 4 cores)</p></li>
<li><p><strong>Memory</strong>: Each worker needs enough RAM for one individual's data</p></li>
<li><p><strong>Overhead</strong>: Setup time ~1-2 seconds; only beneficial for &gt;5-10 individuals</p></li>
<li><p><strong>Progress</strong>: No progress bar (runs silently in parallel)</p></li>
</ul></div>

<div class="section">
<h3 id="timing-comparison">Timing Comparison<a class="anchor" aria-label="anchor" href="#timing-comparison"></a></h3>


<p>For 32 individuals, 3 days each, it=100:</p><ul><li><p>Serial (<code>HMMbehavr</code>): ~160 seconds</p></li>
<li><p>4 cores (<code>HMMbehavrFast</code>): ~45 seconds</p></li>
<li><p>8 cores: ~25 seconds</p></li>
</ul></div>

<div class="section">
<h3 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h3>


<p>If any individual fails to process, that individual returns <code>NULL</code> and
is excluded from the final results. Other individuals continue processing normally.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="HMMbehavr.html">HMMbehavr</a></code> for serial implementation and detailed HMM description
<code><a href="HMMDataPrep.html">HMMDataPrep</a></code> for preparing input data
<code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></code> for details on parallel backends</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic parallel processing with 4 cores</span></span></span>
<span class="r-in"><span><span class="va">hmm_results</span> <span class="op">&lt;-</span> <span class="fu">HMMbehavrFast</span><span class="op">(</span></span></span>
<span class="r-in"><span>  behavtbl <span class="op">=</span> <span class="va">processed_data</span>,</span></span>
<span class="r-in"><span>  n_cores <span class="op">=</span> <span class="fl">4</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use more cores for large dataset</span></span></span>
<span class="r-in"><span><span class="va">hmm_results</span> <span class="op">&lt;-</span> <span class="fu">HMMbehavrFast</span><span class="op">(</span></span></span>
<span class="r-in"><span>  behavtbl <span class="op">=</span> <span class="va">processed_data</span>,</span></span>
<span class="r-in"><span>  it <span class="op">=</span> <span class="fl">200</span>,</span></span>
<span class="r-in"><span>  n_cores <span class="op">=</span> <span class="fl">8</span>,</span></span>
<span class="r-in"><span>  ldcyc <span class="op">=</span> <span class="fl">12</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check available cores first</span></span></span>
<span class="r-in"><span><span class="va">available_cores</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">use_cores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">available_cores</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>  <span class="co"># Leave 2 for system</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">hmm_results</span> <span class="op">&lt;-</span> <span class="fu">HMMbehavrFast</span><span class="op">(</span></span></span>
<span class="r-in"><span>  behavtbl <span class="op">=</span> <span class="va">processed_data</span>,</span></span>
<span class="r-in"><span>  n_cores <span class="op">=</span> <span class="va">use_cores</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Results structure identical to HMMbehavr</span></span></span>
<span class="r-in"><span><span class="va">time_in_states</span> <span class="op">&lt;-</span> <span class="va">hmm_results</span><span class="op">$</span><span class="va">TimeSpentInEachState</span></span></span>
<span class="r-in"><span><span class="va">state_profile</span> <span class="op">&lt;-</span> <span class="va">hmm_results</span><span class="op">$</span><span class="va">VITERBIDecodedProfile</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Arijit Ghosh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

